<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Untitled</title>
  

</head>
<body>
<!-- partial:index.partial.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Studies</title>
    <style>
        :root {
            --bg-color: #000000;
            --surface-color: #1c1c1e;
            --primary-color: #DB4032;
            --secondary-color: #DB4032;
            --on-surface-color: #ffffff;
            --on-surface-muted: #8e8e93;
            --border-color: #38383a;
            --success-color: #34c759;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(var(--border-color) 1px, transparent 0);
            background-size: 40px 40px;
            color: var(--on-surface-color);
            padding: 20px;
            padding-bottom: 80px;
            font-size: 16px;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            gap: 20px;
        }

        .timers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }
        
        hr {
            border: none;
            height: 1px;
            background-color: var(--border-color);
            margin: 15px 0;
        }
        
        button, .button {
            border: none;
            padding: 12px 18px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s ease, transform 0.1s ease;
            font-size: 15px;
            color: var(--on-surface-color);
        }

        button:hover, .button:hover {
            filter: brightness(1.2);
        }

        button:active, .button:active {
            transform: scale(0.97);
        }
        
        button.secondary {
            background-color: #3a3a3c;
        }

        button.secondary:hover {
            background-color: #4a4a4c;
        }
        
        button.danger {
            background-color: var(--primary-color);
        }
        
        button.success {
            background-color: var(--success-color);
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }

        .icon-btn {
            padding: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-btn svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        input[type="text"], input[type="date"], input[type="number"], textarea {
            background-color: var(--surface-color);
            color: var(--on-surface-color);
            border: 1px solid var(--border-color);
            padding: 12px;
            border-radius: 10px;
            width: 100%;
            font-size: 16px;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .job-header {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            overflow: hidden;
        }

        .job-toggles {
            flex-grow: 1;
            overflow-x: auto;
            white-space: nowrap;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .job-toggles::-webkit-scrollbar {
            display: none;
        }

        .job-toggle {
            display: inline-block;
            padding: 10px 15px;
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            margin-right: 10px;
        }

        .job-toggle.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: var(--on-surface-color);
            font-weight: 600;
        }

        .add-job-btn {
            font-size: 28px;
            font-weight: 300;
            line-height: 1;
        }

        .timer-card {
            background-color: var(--surface-color);
            border-radius: 16px;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .timer-content {
            background-color: var(--surface-color);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            position: relative;
            z-index: 2;
            transition: transform 0.3s ease;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .delete-action {
            position: absolute;
            top: 0;
            right: 0;
            width: 80px;
            height: 100%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }

        .delete-btn {
            background: none;
            border: none;
            padding: 0;
        }

        .delete-btn svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        .timer-card.swiped .timer-content {
            transform: translateX(-80px);
        }

        .task-title {
            font-size: 18px;
            font-weight: 600;
            padding: 5px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            text-align: center;
        }
        
        .task-title:hover {
            background-color: #2c2c2e;
        }

        .task-input {
            font-size: 18px;
            font-weight: 600;
            text-align: center;
        }

        .autocomplete-list {
            position: absolute;
            top: 55px;
            left: 20px;
            background-color: #2c2c2e;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            z-index: 1000;
            width: calc(100% - 40px);
            max-height: 150px;
            overflow-y: auto;
        }

        .autocomplete-item {
            padding: 10px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .autocomplete-item:hover {
            background-color: var(--primary-color);
            color: var(--on-surface-color);
        }
        
        .timer-display {
            font-size: 42px;
            font-family: 'SF Mono', 'Roboto Mono', monospace;
            text-align: center;
            color: var(--secondary-color);
            font-weight: 400;
        }
        
        .pulsing-delay {
            animation: pulse 1.5s infinite;
        }

        .timer-controls, .timer-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .timer-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: var(--on-surface-muted);
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .stat-item label {
            font-weight: 500;
            color: var(--on-surface-color);
        }

        .technician-input {
            width: 30px; 
            height: 30px;
            padding: 2px;
            text-align: center;
            -moz-appearance: textfield;
        }
        .technician-input::-webkit-outer-spin-button,
        .technician-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--surface-color);
            padding: 30px;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            border: 1px solid var(--border-color);
        }
        
        .modal-content h2 {
            margin-bottom: 10px;
            color: var(--on-surface-color);
            font-weight: 600;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 0.8fr 1.2fr;
            gap: 15px;
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        #plant-selection-modal {
            display: flex;
        }
        .plant-bubbles {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .plant-bubble {
            padding: 20px;
            border-radius: 12px;
            background-color: #3a3a3c;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .plant-bubble.selected {
            background-color: var(--primary-color);
        }
        .plant-bubble.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .footer-logo-container {
            position: fixed;
            bottom: 15px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            z-index: -1;
        }
        .footer-logo {
            height: 50px;
            width: auto;
            opacity: 0.5;
        }
        .add-timer-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 80px;
            height: 80px;
            background-color: #3a3a3c;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            font-weight: 300;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid var(--border-color);
            z-index: 999;
            line-height: 1;
        }

    </style>
</head>
<body>

    <div class="app-container">
        <header>
            <div class="job-header">
                <div class="job-toggles" id="job-toggles-container">
                </div>
            </div>
            <div class="header-actions">
                 <button class="add-job-btn icon-btn secondary" id="add-job-btn">+</button>
                 <button id="shareBtn" class="icon-btn secondary" style="display: none;">
                     <svg viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"></path></svg>
                 </button>
                 <button id="downloadBtn" class="icon-btn secondary" style="display: none;">
                     <svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"></path></svg>
                 </button>
            </div>
        </header>

        <main id="timers-grid" class="timers-grid">
        </main>
    </div>

    <div id="plant-selection-modal" class="modal">
        <div class="modal-content">
            <h2>Choose Plant</h2>
            <div class="plant-bubbles">
                <div class="plant-bubble" data-plant="OK">OK</div>
                <div class="plant-bubble disabled" data-plant="NC">NC</div>
                <div class="plant-bubble" data-plant="IA">IA</div>
                <div class="plant-bubble" data-plant="PA">PA</div>
                <div class="plant-bubble disabled" data-plant="FL">FL</div>
                <div class="plant-bubble disabled" data-plant="CA">CA</div>
            </div>
            <button id="confirm-plant-btn" class="secondary" disabled>Confirm</button>
        </div>
    </div>

    <div id="newJobModal" class="modal">
        <div class="modal-content">
            <h2>Create New Job</h2>
            <form id="newJobForm">
                <div class="form-grid">
                    <input type="date" id="jobDate" required>
                    <input type="number" inputmode="numeric" id="jobNumber" placeholder="Job Number" required>
                    <input type="number" inputmode="numeric" id="fanNumber" placeholder="Fan Number" required>
                    <input type="number" inputmode="numeric" id="stationNumber" placeholder="Station Number" required>
                    <input type="number" inputmode="numeric" id="rtuSize" placeholder="RTU Size" required>
                    <input type="number" inputmode="numeric" id="lineNumber" placeholder="Line Number" required>
                </div>
                 <hr>
                <div style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button type="button" class="secondary" id="cancelJobBtn">Cancel</button>
                    <button type="submit">Create Job</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="delayReasonModal" class="modal">
        <div class="modal-content">
            <h2>Log Interruption</h2>
            <form id="delayReasonForm">
                <textarea id="delayReasonInput" placeholder="Enter reason for the delay..."></textarea>
                <div class="checkbox-container">
                    <input type="checkbox" id="isDefectCheckbox">
                    <label for="isDefectCheckbox">Did a defect cause delay?</label>
                </div>
                 <hr>
                <div style="display: flex; justify-content: flex-end;">
                    <button type="submit">Log Reason</button>
                </div>
            </form>
        </div>
    </div>

    <div class="footer-logo-container">
        <img src="https://i.imgur.com/GIWnp6T.png" alt="Logo" class="footer-logo">
    </div>

    <button class="add-timer-fab" id="add-timer-fab">+</button>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const TASK_LISTS = {
            OK: [
                {id: 'ok1.3.2.1.1', description: 'Assemble Base'}, {id: 'ok1.3.2.1.2', description: 'Install Wet Wall'},
                {id: 'ok1.3.2.1.3', description: 'Install ASB'}, {id: 'ok1.3.2.1.4', description: 'Install CDP'},
                {id: 'ok1.3.2.1.5', description: 'Install BBOP'}, {id: 'ok1.3.2.1.6', description: 'Install A2L Sensor'},
                {id: 'ok2.1.1', description: 'Install Drain Pan'}, {id: 'ok2.1.2', description: 'Install Evaporator and Reheat Coil'},
                {id: 'ok2.1.3', description: 'Install Vertical Fiter Track/ASLDP'}, {id: 'ok2.1.4', description: 'Install Filter Track'},
                {id: 'ok2.1.5', description: 'Install Wire Loops on Filter Track'}, {id: 'ok2.1.6', description: 'Install Intake Sensor bracket'},
                {id: 'ok2.1.7', description: 'Install Intake RH'}, {id: 'ok2.1.8', description: 'Install Junction Box'},
                {id: 'ok2.2.1', description: 'Install RCS'}, {id: 'ok2.2.2', description: 'Install ECRDP'},
                {id: 'ok2.2.3', description: 'Install Compressor and Accumulator Support'}, {id: 'ok2.2.4', description: 'Install Compressor'},
                {id: 'ok2.2.5', description: 'Install Accumulator'}, {id: 'ok2.2.6', description: 'Install CSCS Grommets'},
                {id: 'ok2.2.7', description: 'Instal Gasket on CSCS'}, {id: 'ok2.2.8', description: 'Install Wire Loops on CSCS'},
                {id: 'ok2.3.1', description: 'Install Discharge Averaging Sensor'}, {id: 'ok2.3.2', description: 'Install Knockout Plate'},
                {id: 'ok2.3.3', description: 'Install LFMA'}, {id: 'ok2.3.4', description: 'Install BAVS'},
                {id: 'ok2.3.5', description: 'Install Blower Supports'}, {id: 'ok2.3.6', description: 'Install Furnace Flashings'},
                {id: 'ok2.3.7', description: 'Install Furnace Assembly'}, {id: 'ok2.3.8', description: 'Install Electric Furnace'},
                {id: 'ok2.3.9', description: 'Install Blower Assembly'}, {id: 'ok2.3.10', description: 'Install ECRW'},
                {id: 'ok2.3.11', description: 'Install ILECBW'}, {id: 'ok2.3.12', description: 'Install Electrical Cabinet Shelf'},
                {id: 'ok2.3.13', description: 'Install ECLDP'}, {id: 'ok2.3.14', description: 'Vacuum Unit'},
                {id: 'ok2.3.15', description: 'Install Electrical Cabinet Insert'}, {id: 'ok3.1.1', description: 'Install Intake Averaging Sensor'},
                {id: 'ok3.1.2', description: 'Vacuum Debris'}, {id: 'ok3.1.3', description: 'Install DFP'},
                {id: 'ok3.1.4', description: 'Install Damper'}, {id: 'ok3.1.5', description: 'Install Smoke Detector'},
                {id: 'ok3.1.6', description: 'Install Return Sensors'}, {id: 'ok3.1.7', description: 'Route Damper Wires'},
                {id: 'ok3.1.9', description: 'Install Discharge Sensors'}, {id: 'ok3.2.1', description: 'Install Gas Train Manifold'},
                {id: 'ok3.2.2', description: 'Install Draft Inducer and furnace Ducting assembly'}, {id: 'ok3.2.3', description: 'Install Furnace Drain'},
                {id: 'ok3.2.4', description: 'Install Furnace Vent Cover'}, {id: 'ok3.2.5', description: 'Install Drain Heater'},
                {id: 'ok3.2.6', description: 'Install gas Train Assembly'}, {id: 'ok3.3.1', description: 'Cut Coil Headers'},
                {id: 'ok3.3.2', description: 'Braze EEV'}, {id: 'ok3.3.3', description: 'Braze FDEEV to EEV'},
                {id: 'ok3.3.4', description: 'Braze AC'}, {id: 'ok3.3.5', description: 'Braze ICA'},
                {id: 'ok3.3.6', description: 'Braze on FDEEV to Filter Dryer'}, {id: 'ok3.3.7', description: 'Braze OCFD'},
                {id: 'ok3.3.8', description: 'Braze Prebraze Assembly'}, {id: 'ok3.3.9', description: 'Braze TEEOC'},
                {id: 'ok4.1.1', description: 'Route Airside Harness'}, {id: 'ok4.1.2', description: 'Install Float switch'},
                {id: 'ok4.1.3', description: 'Install Reheat Sensors'}, {id: 'ok4.1.4', description: 'Wire EEV'},
                {id: 'ok4.1.5', description: 'Wire Clogged Filter Switch'}, {id: 'ok4.1.6', description: 'Ziptie Airside Wiring'},
                {id: 'ok4.1.7', description: 'Route Blower Wires'}, {id: 'ok4.1.8', description: 'Wire Damper Motor'},
                {id: 'ok4.1.9', description: 'Attatch Junction Box Lid'}, {id: 'ok4.1.10', description: 'Install ASCDP'},
                {id: 'ok4.1.11', description: 'Mount Door Switch'}, {id: 'ok4.1.12', description: 'Install CDTS'},
                {id: 'ok4.1.13', description: 'Install CBTS'}, {id: 'ok4.1.14', description: 'Install ECTB'},
                {id: 'ok4.1.15', description: 'Install Lid Liner'}, {id: 'ok4.1.16', description: 'Install Lid Insulaton'},
                {id: 'ok4.2.1', description: 'Route Condensing Side Wiring harness '}, {id: 'ok4.2.2', description: 'Attatch tranducers, switches, sensors'},
                {id: 'ok4.2.3', description: 'Insulate Piping'}, {id: 'ok4.2.4', description: 'Fill Out QA Mod'},
                {id: 'ok4.2.5', description: 'Install Compressor Sound Blanket'}, {id: 'ok4.2.6', description: 'Install Oil Boost Solenoid'},
                {id: 'ok4.2.7', description: 'Install Condensing Coil'}, {id: 'ok5.1.1', description: 'Wire Gas Train'},
                {id: 'ok5.1.2', description: 'Wire Electric Heater'}, {id: 'ok5.1.3', description: 'Wire Powered Exhaust'},
                {id: 'ok5.1.4', description: 'Wire Refrigerant harness'}, {id: 'ok5.1.5', description: 'Terminate Heat Pump Solenoid'},
                {id: 'ok5.1.6', description: 'Terminate Extreme Low Ambient Solenoid'}, {id: 'ok5.1.7', description: 'Terminate Pre Defrost Solenoid'},
                {id: 'ok5.1.8', description: 'Terminate Oil Boost Solenoid'}, {id: 'ok5.1.9', description: 'Install Air Proving Tube'},
                {id: 'ok5.1.10', description: 'Install Clogged Filter Switch'}, {id: 'ok5.2.1', description: 'Install CPU'},
                {id: 'ok5.2.2', description: 'Install CFSs'}, {id: 'ok5.2.3', description: 'Install Vibration Hangers'},
                {id: 'ok5.2.4', description: 'Install Condensing Side Lid'}, {id: 'ok5.2.5', description: 'Install Condensing Fans'},
                {id: 'ok5.2.6', description: 'Install Hail Guard'}, {id: 'ok5.3.1', description: 'Install Air Side Lid'},
                {id: 'ok5.3.2', description: 'Install ECRDP (SZ1 Only)'}, {id: 'ok5.3.3', description: 'Install FRPXX'},
                {id: 'ok5.3.4', description: 'Install Airside Doors'}, {id: 'ok6.1.1', description: 'Wire Airside Sensors'},
                {id: 'ok6.1.2', description: 'Fill QC Mod for Supply VFD'}, {id: 'ok6.1.3', description: 'Install Distribution Block Assembly'},
                {id: 'ok6.1.4', description: 'Install Supply VFD'}, {id: 'ok6.1.5', description: 'Terminate Disconnect to distribution Block'},
                {id: 'ok6.1.6', description: 'Terminate Transformer and Supply VFD Line Side to Dist Block'}, {id: 'ok6.1.7', description: 'Wire Door Switches'},
                {id: 'ok6.1.8', description: 'Wire Blower Motor Wires to Supply VFD'}, {id: 'ok6.2.1', description: 'Braze on Condensing Coil'},
                {id: 'ok7.1.1', description: 'Install Compressor VFD (if sz1)'}, {id: 'ok7.1.2', description: 'Install Powered Exhaust Transformer'},
                {id: 'ok7.1.3', description: 'Install Conv. Outlet Transformer'}, {id: 'ok7.1.4', description: 'Install and Terminate Cabinet Heater'},
                {id: 'ok7.1.5', description: 'Install PS-10'}, {id: 'ok7.1.6', description: 'Install and Terminate BACNet'},
                {id: 'ok7.1.7', description: 'Install Unit HMI'}, {id: 'ok7.1.8', description: 'Wire 2nd Suction Line 10k'},
                {id: 'ok7.1.9', description: 'Install LED Strip'}, {id: 'ok7.1.10', description: 'Install SCADA'},
                {id: 'ok8.1.1', description: 'Wire Condensing Fans'}, {id: 'ok8.1.2', description: 'Install Compressor VFD'},
                {id: 'ok8.1.3', description: 'Wire Compressor VFD'}, {id: 'ok8.1.4', description: 'Terminate LED Wiring to Door Switch'},
                {id: 'ok9.1.1', description: 'Install Electrical Cabinet Doors'}, {id: 'ok9.1.2', description: 'Fill Out QC Mod'},
                {id: 'ok9.1.3', description: 'Install all Unit Stickers and Schematics'}, {id: 'ok9.2.1', description: 'Gather Unit Filters'},
                {id: 'ok9.2.2', description: 'Gather Unit Small Parts/ Unit Manuals'}, {id: 'ok9.2.3', description: 'Apply Silicone to Damper sides'},
                {id: 'ok9.2.4', description: 'Install Economizer '}, {id: 'ok9.2.5', description: 'Install Return Cover'}
            ],
            PA: [
                {id: 'PA1.2.1.1', description: 'Assemble Base'}, {id: 'PA1.2.1.2', description: 'Install Wet Wall'},
                {id: 'PA1.2.1.3', description: 'Install ASB'}, {id: 'PA1.2.4', description: 'Install Compressor and Accumulator Support'},
                {id: 'PA1.2.5', description: 'Install 575 CS '}, {id: 'PA1.2.6', description: 'Install BBOP'},
                {id: 'PA1.2.7', description: 'Blower supports vertical'}, {id: 'PA1.2.8', description: 'Install RCS'},
                {id: 'PA1.2.9', description: 'Install ECRDP'}, {id: 'PA1.2.10', description: 'Discharge Avg hangers (Down)'},
                {id: 'PA1.1.4', description: 'Install CDP'}, {id: 'PA1.1.5', description: 'Install Fiter Tracks'},
                {id: 'PA1.1.6', description: 'Install Drain Pan'}, {id: 'PA1.1.7', description: 'Install EBA (Sz 1)'},
                {id: 'PA1.2.1.11', description: 'Hit rivets on top of Cscs '}, {id: 'PA2.1.1', description: 'Install Blower Suport'},
                {id: 'PA2.1.2', description: 'Install Discharge avg sensor'}, {id: 'PA2.1.3', description: 'Install furnace'},
                {id: 'PA2.1.4', description: 'Install ECRW'}, {id: 'PA2.1.5', description: 'Install ECLDP'},
                {id: 'PA2.1.6', description: 'Install Gas Train Manifold'}, {id: 'PA2.1.7', description: 'Door prop bracket'},
                {id: 'PA2.1.8', description: 'Install Furnace Drain'}, {id: 'PA2.1.9', description: 'Install Drain Heater'},
                {id: 'PA2.1.10', description: 'Install gas Train Assembly'}, {id: 'PA2.1.11', description: 'Install Electrical Cabinet Shelf'},
                {id: 'PA2.1.12', description: 'Install ECRDP (size 1)'}, {id: 'PA2.2.1', description: 'ASDLP '},
                {id: 'PA2.2.2', description: 'Install Junction Box'}, {id: 'PA2.2.3', description: 'Install Intake Averaging Sensor'},
                {id: 'PA2.2.4', description: 'Install Intake RH'}, {id: 'PA2.2.5', description: 'Install Damper'},
                {id: 'PA2.2.6', description: 'Install Return Sensors'}, {id: 'PA2.2.7', description: 'Route Cat 5 Cable'},
                {id: 'PA2.2.8', description: 'Smoke detector'}, {id: 'PA2.2.9', description: 'Install Smoke Detector'},
                {id: 'PA2.2.10', description: 'Route Damper Wires'}, {id: 'PA2.2.11', description: 'Wire Damper Motor'},
                {id: 'PA2.2.12', description: 'Install EBA (Size 2-3)'}, {id: 'PA2.2.13', description: 'Brush Plate'},
                {id: 'PA2.3.1', description: 'Install Compressor'}, {id: 'PA2.3.2', description: 'Install Wire Loops on CSCS'},
                {id: 'PA2.3.3', description: 'Install Accumlator'}, {id: 'PA2.3.4', description: 'Install Evaporator and Reheat Coil'},
                {id: 'PA2.3.5', description: 'Cut Coil Headers'}, {id: 'PA2.3.6', description: 'Install Piping/ EEV'},
                {id: 'PA2.3.7', description: 'Oil Dryer Filter bracket'}, {id: 'PA2.3.8', description: 'Install Brazed subassmbly'},
                {id: 'PA3.1.1', description: 'Install Discharge Sensors'}, {id: 'PA3.1.2', description: 'Install Discharge Averaging Sensor'},
                {id: 'PA3.1.3', description: 'Install A2L Sensor'}, {id: 'PA3.1.4', description: 'Install Reheat Sensors'},
                {id: 'PA3.1.5', description: 'Install Float switch'}, {id: 'PA3.1.6', description: 'Install EEV bracket'},
                {id: 'PA3.1.7', description: 'Wire EEV'}, {id: 'PA3.1.8', description: 'Install ASCDP'},
                {id: 'PA3.1.9', description: 'Mount Door Switch'}, {id: 'PA3.1.10', description: 'Route Airside Harness'},
                {id: 'PA3.1.11', description: 'Install Air Proving Tube'}, {id: 'PA3.1.12', description: 'Wire Clogged Filter Switch'},
                {id: 'PA3.1.13', description: 'Install Blower'}, {id: 'PA3.1.14', description: 'Route Blower Wires'},
                {id: 'PA3.1.15', description: 'Install Airside top Door Posts'}, {id: 'PA3.1.16', description: 'Install Lid Liner'},
                {id: 'PA3.1.17', description: 'Rivcerts'}, {id: 'PA3.1.18', description: 'Install Air Side Lid'},
                {id: 'PA3.1.19', description: 'Install Top Damper Screws'}, {id: 'PA3.2.1', description: 'Braze Piping'},
                {id: 'PA3.2.2', description: 'Low ambient pipe install '}, {id: 'PA3.2.3', description: 'Braze low ambient'},
                {id: 'PA3.2.4', description: 'Wire Low Ambient solenoid'}, {id: 'PA3.2.5', description: 'Install shrader cores'},
                {id: 'PA3.2.6', description: 'Low Pressure'}, {id: 'PA3.2.7', description: 'Route Condensing Side Harness'},
                {id: 'PA3.2.8', description: 'Attatch tranducers, switches, sensors'}, {id: 'PA3.2.9', description: 'Run Reheat Valve wire '},
                {id: 'PA3.2.10', description: 'Install heat pump solenoid '}, {id: 'PA3.2.11', description: 'Install AIS'},
                {id: 'PA3.3.1', description: 'Prep Electrical Cabinet'}, {id: 'PA3.3.2', description: 'Install Grounding Block'},
                {id: 'PA3.3.3', description: 'Install Supply VFD'}, {id: 'PA3.3.4', description: 'Install Transformer'},
                {id: 'PA3.3.5', description: 'Wire Transformer'}, {id: 'PA3.3.6', description: 'Wire Blower Motor Wires to Supply VFD'},
                {id: 'PA3.3.7', description: 'Install Disconnect'}, {id: 'PA3.3.8', description: 'Route Airside Wires'},
                {id: 'PA3.3.9', description: 'Wire Gas Train'}, {id: 'PA3.3.10', description: 'Wire Electric Heater'},
                {id: 'PA3.3.11', description: 'Furnace Ducting assembly'}, {id: 'PA3.3.12', description: 'Run Inducer Wire'},
                {id: 'PA3.3.13', description: 'Install Electrical Outlet Box'}, {id: 'PA3.3.14', description: 'Door Prop'},
                {id: 'PA3.3.15', description: 'Install Compressor Support Bracket and Compressor VFD Size 1'}, {id: 'PA4.1.1', description: 'Insulate Piping'},
                {id: 'PA4.1.2', description: 'Install Compressor Sound Blanket'}, {id: 'PA4.1.3', description: 'Install Crakcase Heater'},
                {id: 'PA4.1.4', description: 'Run Condensing Fan Wires'}, {id: 'PA4.1.5', description: 'Install Condensing Coil'},
                {id: 'PA4.1.6', description: 'Braze on Condensing Coil'}, {id: 'PA4.1.7', description: 'Install CUFP'},
                {id: 'PA4.1.8', description: 'Install CFSs'}, {id: 'PA4.2.1', description: 'Wire Blower Motor Wires to Supply VFD'},
                {id: 'PA4.2.2', description: 'Wire Powered Exhaust'}, {id: 'PA4.2.3', description: 'Wire Damper Motor'},
                {id: 'PA4.2.4', description: 'Wire powered vent (Opt)'}, {id: 'PA4.2.5', description: 'Install and Terminate Cabinet Heater'},
                {id: 'PA4.2.6', description: 'Wire heated drain (Opt)'}, {id: 'PA4.2.7', description: 'Mapp bracket'},
                {id: 'PA4.2.8', description: 'Install Compressor VFD'}, {id: 'PA4.2.9', description: 'Install Clogged Filter Switch'},
                {id: 'PA4.2.10', description: 'Install Distribution Block Assembly'}, {id: 'PA4.2.11', description: 'Terminate Disconnect to distribution Block'},
                {id: 'PA4.2.12', description: 'Terminate Transformer and Supply VFD Line Side to Dist Block'}, {id: 'PA4.2.13', description: 'Wire 575 Transformer to Distribution Block'},
                {id: 'PA4.2.14', description: 'Wire TR-1 to Distribution Block'}, {id: 'PA5.1.1', description: 'Remove stickers'},
                {id: 'PA5.1.2', description: 'Install Vibration Hangers'}, {id: 'PA5.1.3', description: 'Install Condensing Side Lid'},
                {id: 'PA5.1.4', description: 'Install Electrical Cabinet Doors'}, {id: 'PA5.1.5', description: 'Install Condensing Fans'},
                {id: 'PA5.1.6', description: 'VTI High Pressure Test'}, {id: 'PA5.1.7', description: 'Wire Condensing Fans'},
                {id: 'PA5.1.8', description: 'Start Evacuation'}, {id: 'PA5.2.1', description: 'Wire Airside Sensors'},
                {id: 'PA5.2.2', description: 'Wire Compressor VFD'}, {id: 'PA5.2.3', description: 'Wire Door Switches'},
                {id: 'PA5.2.4', description: 'Wire Condensing Fans'}, {id: 'PA5.2.5', description: 'Crankcase heater wiring'},
                {id: 'PA5.2.6', description: 'Terminate Heat Pump Solenoid'}, {id: 'PA5.2.7', description: 'Terminate Extreme Low Ambient Solenoid'},
                {id: 'PA5.2.8', description: 'Wire in Reheat Valve'}, {id: 'PA5.2.9', description: 'Terminate Heat Pump Pressure Switch'},
                {id: 'PA5.2.10', description: 'Coil thermistor pins '}, {id: 'PA5.2.11', description: 'Wire Refrigerant harness'},
                {id: 'PA5.2.12', description: 'Terminate LED Wiring to Door Switch (sz1)'}, {id: 'PA5.2.13', description: 'Run Cat 5 in electrical cabinet'},
                {id: 'PA6.1.1', description: 'Finish VTI Charge Testing'}, {id: 'PA6.1.2', description: 'Install Economizer '},
                {id: 'PA6.1.3', description: 'Install Powered Exhaust'}, {id: 'PA6.1.4', description: 'Wire Powered Exhaust'},
                {id: 'PA6.1.5', description: 'Install Tamper Gel'}, {id: 'PA6.1.6', description: 'Gather Unit Small Parts/ Unit Manuals'},
                {id: 'PA6.1.7', description: 'QC Inspect Unit'}, {id: 'PA6.1.8', description: 'Install all Unit Stickers and Schematics'},
                {id: 'PA6.1.9', description: 'Apply Silicone to Damper sides'}, {id: 'PA6.2.1', description: 'Terminate LED Wiring to Door Switch'},
                {id: 'PA6.2.2', description: 'Install Antenna'}, {id: 'PA6.2.3', description: 'Install SCADA'},
                {id: 'PA6.2.4', description: 'Install Unit HMI'}, {id: 'PA6.2.5', description: 'Wire 2nd Suction Line 10k'},
                {id: 'PA6.2.6', description: 'Mount Door Switch'}, {id: 'PA6.2.7', description: 'Install space temp'},
                {id: 'PA6.2.8', description: 'Install Electrical Cabinet Doors'}, {id: 'PA6.2.9', description: 'Install Hail Guard'},
                {id: 'PA6.2.10', description: 'Insatll Pressure Transmitter'}, {id: 'PA6.2.11', description: 'Gasket around Blower/Coil'}
            ],
            IA: [
                {id: 'IA1.2.1.1', description: 'Assemble Base'}, {id: 'IA1.2.1.2', description: 'Install Wet Wall'},
                {id: 'IA1.2.1.3', description: 'Install ASB'}, {id: 'IA1.2.4', description: 'Install Compressor and Accumulator Support'},
                {id: 'IA1.1.4', description: 'Install BBOP'}, {id: 'IA1.2.5', description: 'Install CDP'},
                {id: 'IA1.1.5', description: 'Install Discharge avg sensor'}, {id: 'IA1.1.6', description: 'Install Blower Suport'},
                {id: 'IA1.1.7', description: 'Install Furnace Flashings'}, {id: 'IA1.1.8', description: 'Install Furnace'},
                {id: 'IA1.1.9', description: 'Install ECRW'}, {id: 'IA1.1.10', description: 'Install ECLDP'},
                {id: 'IA1.1.11', description: 'Install Electrical Cabinet Shelf'}, {id: 'IA1.1.12', description: 'Install Electric Insert'},
                {id: 'IA1.1.13', description: 'Install Blower'}, {id: 'IA1.2.6', description: 'Install Drain Pan'},
                {id: 'IA1.2.7', description: 'Install Evaporator and Reheat Coil'}, {id: 'IA1.2.8', description: 'Install Fiter Tracks/ASLDP'},
                {id: 'IA1.2.9', description: 'Install Intake RH'}, {id: 'IA1.2.10', description: 'Install Intake Averaging Sensor'},
                {id: 'IA1.2.10', description: 'Install Junction Box'}, {id: 'IA1.2.11', description: 'Install ECRDP'},
                {id: 'IA1.2.12', description: 'Install Damper'}, {id: 'IA1.3.5', description: 'Install Compressor'},
                {id: 'IA1.3.6', description: 'Install Accumulator'}, {id: 'IA1.3.7', description: 'Route Condensing Side Wiring harness '},
                {id: 'IA1.3.8', description: 'Braze EEV'}, {id: 'IA1.3.9', description: 'Braze FDEEV to EEV'},
                {id: 'IA1.3.10', description: 'Braze AC'}, {id: 'IA1.3.11', description: 'Braze ICA'},
                {id: 'IA1.3.12', description: 'Braze Prebraze Assembly'}, {id: 'IA1.3.13', description: 'Attatch tranducers, switches, sensors'},
                {id: 'IA2.1.1', description: 'Install Supply VFD'}, {id: 'IA2.1.2', description: 'Install Distribution Block Assembly'},
                {id: 'IA2.1.3', description: 'Install Air Proving Tube'}, {id: 'IA2.1.4', description: 'Discharge Averaging Sensor'},
                {id: 'IA2.1.5', description: 'Route Cat 5 Cable'}, {id: 'IA2.1.6', description: 'Install Return Sensors'},
                {id: 'IA2.1.7', description: 'Route Damper Wires'}, {id: 'IA2.1.8', description: 'Wire Damper Motor'},
                {id: 'IA2.1.9', description: 'Install Intake Averaging Sensor'}, {id: 'IA2.2.1', description: 'Install Furnace Drain'},
                {id: 'IA2.2.2', description: 'Install Drain Heater'}, {id: 'IA2.2.3', description: 'Install Gas Train Manifold'},
                {id: 'IA2.2.4', description: 'Install gas Train Assembly'}, {id: 'IA2.2.5', description: 'Install Draft Inducer and furnace Ducting assembly'},
                {id: 'IA2.2.6', description: 'Install Furnace Vent Cover'}, {id: 'IA3.1.1', description: 'Helium Sniff test'},
                {id: 'IA3.1.2', description: 'Insulate Piping'}, {id: 'IA3.1.3', description: 'Install Condensing Side Stickers'},
                {id: 'IA3.1.4', description: 'Install ECRDP'}, {id: 'IA3.1.5', description: 'Install Condensing Coil'}
            ]
        };
        let PREDEFINED_TASKS = [];

        const timersGrid = document.getElementById('timers-grid');
        const addTimerFab = document.getElementById('add-timer-fab');
        const shareBtn = document.getElementById('shareBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const jobTogglesContainer = document.getElementById('job-toggles-container');
        const addJobBtn = document.getElementById('add-job-btn');
        const newJobModal = document.getElementById('newJobModal');
        const delayReasonModal = document.getElementById('delayReasonModal');
        const newJobForm = document.getElementById('newJobForm');
        const cancelJobBtn = document.getElementById('cancelJobBtn');
        const delayReasonForm = document.getElementById('delayReasonForm');
        const plantSelectionModal = document.getElementById('plant-selection-modal');
        const confirmPlantBtn = document.getElementById('confirm-plant-btn');

        let appState = { jobs: {}, jobOrder: [], currentJobId: null, timerInterval: null, modalCallback: null, selectedPlant: null };
        
        function init() {
            document.querySelectorAll('.plant-bubble').forEach(bubble => {
                bubble.addEventListener('click', () => {
                    if (bubble.classList.contains('disabled')) {
                        alert('This plant cannot be selected pending completion of task list.');
                        return;
                    }
                    document.querySelectorAll('.plant-bubble').forEach(b => b.classList.remove('selected'));
                    bubble.classList.add('selected');
                    appState.selectedPlant = bubble.dataset.plant;
                    confirmPlantBtn.disabled = false;
                });
            });

            confirmPlantBtn.addEventListener('click', () => {
                if (!appState.selectedPlant) return;

                const proceed = () => {
                    PREDEFINED_TASKS = TASK_LISTS[appState.selectedPlant];
                    plantSelectionModal.style.display = 'none';
                    mainInit();
                };

                if (appState.selectedPlant === 'IA') {
                    if (confirm(`The task list for ${appState.selectedPlant} Plant is incomplete. Proceed?`)) {
                        proceed();
                    }
                } else {
                    proceed();
                }
            });
        }

        function mainInit() {
            addJobBtn.addEventListener('click', () => openNewJobModal());
            newJobForm.addEventListener('submit', handleCreateJob);
            cancelJobBtn.addEventListener('click', () => newJobModal.style.display = 'none');
            delayReasonForm.addEventListener('submit', handleDelayReasonSubmit);
            addTimerFab.addEventListener('click', addNewTimer);
            downloadBtn.addEventListener('click', downloadCsv);
            shareBtn.addEventListener('click', shareCsv);
            appState.timerInterval = setInterval(updateAllDisplays, 100);
            updateUI();
        }
        
        function updateUI() {
            jobTogglesContainer.innerHTML = '';
            appState.jobOrder.forEach((jobId, index) => {
                const job = appState.jobs[jobId];
                const toggle = document.createElement('div');
                toggle.className = 'job-toggle';
                toggle.textContent = `Job# ${job.details.JobNumber || ''}`;
                toggle.dataset.jobId = jobId;
                if (jobId === appState.currentJobId) {
                    toggle.classList.add('active');
                }
                toggle.addEventListener('click', () => {
                    appState.currentJobId = jobId;
                    updateUI();
                });
                jobTogglesContainer.appendChild(toggle);
            });

            addJobBtn.style.display = appState.jobOrder.length < 10 ? 'flex' : 'none';

            timersGrid.innerHTML = '';
            if (appState.jobOrder.length > 0) {
                downloadBtn.style.display = 'flex';
                shareBtn.style.display = 'flex';
            } else {
                downloadBtn.style.display = 'none';
                shareBtn.style.display = 'none';
            }

            if (appState.currentJobId && appState.jobs[appState.currentJobId]) {
                addTimerFab.style.display = 'flex';
                appState.jobs[appState.currentJobId].timers.forEach(timer => timersGrid.appendChild(createTimerElement(timer)));
            } else {
                addTimerFab.style.display = 'none';
                if (appState.jobOrder.length === 0) {
                     timersGrid.innerHTML = '<p style="color: var(--on-surface-muted); text-align: center; grid-column: 1 / -1;">Click the + to create a new job.</p>';
                } else {
                     timersGrid.innerHTML = '<p style="color: var(--on-surface-muted); text-align: center; grid-column: 1 / -1;">Select a job to begin.</p>';
                }
            }
        }

        function openNewJobModal() {
            document.getElementById('jobDate').valueAsDate = new Date();
            newJobModal.style.display = 'flex';
        }

        function handleCreateJob(e) {
            e.preventDefault();
            const jobDetails = {
                Date: document.getElementById('jobDate').value,
                JobNumber: document.getElementById('jobNumber').value,
                FanNumber: document.getElementById('fanNumber').value,
                StationNumber: document.getElementById('stationNumber').value,
                RTUSize: document.getElementById('rtuSize').value,
                LineNumber: document.getElementById('lineNumber').value,
            };

            if (!jobDetails.Date || !jobDetails.JobNumber || !jobDetails.FanNumber || !jobDetails.StationNumber || !jobDetails.RTUSize || !jobDetails.LineNumber) {
                alert('All fields are required to create a job.');
                return;
            }
            
            const newJobId = `job-${Date.now()}`;
            appState.jobs[newJobId] = { details: jobDetails, timers: [] };
            appState.jobOrder.push(newJobId);
            appState.currentJobId = newJobId;
            newJobForm.reset();
            newJobModal.style.display = 'none';
            updateUI();
        }

        function createTimerObject() {
            return { id: `timer-${Date.now()}`, taskID: 'N/A', taskDescription: 'Assign Task', startTime: 0, elapsedTime: 0, isRunning: false, technicians: 1, interruptions: 0, defects: 0, downtime: 0, isDelayLapActive: false, delayLapStartTime: 0, delayReasons: [] };
        }

        function addNewTimer() {
            if (!appState.currentJobId) return;
            appState.jobs[appState.currentJobId].timers.push(createTimerObject());
            updateUI();
        }
        
        function createTimerElement(timer) {
            const card = document.createElement('div');
            card.className = 'timer-card';
            card.id = timer.id;
            
            card.innerHTML = `
                <div class="delete-action">
                    <button class="delete-btn">
                        <svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"></path></svg>
                    </button>
                </div>
                <div class="timer-content">
                    <div class="task-title" data-timer-id="${timer.id}">${timer.taskDescription}</div>
                    <div class="timer-display ${timer.isDelayLapActive && timer.isRunning ? 'pulsing-delay' : ''}">00:00:00.0</div>
                    <div class="timer-controls">
                        <button class="start-pause-btn ${timer.isRunning ? 'danger' : 'success'}">${timer.isRunning ? 'Stop' : 'Start'}</button>
                        <button class="reset-btn secondary">Reset</button>
                    </div>
                    <div class="timer-actions">
                        <button class="delay-btn ${timer.isDelayLapActive ? 'danger' : 'success'}">${timer.isDelayLapActive ? 'End Delay' : 'Start Delay'}</button>
                    </div>
                    <div class="timer-stats">
                        <div class="stat-item">
                            <label for="techs-${timer.id}">Techs:</label>
                            <input type="number" inputmode="numeric" pattern="[0-9]*" class="technician-input" id="techs-${timer.id}" value="${timer.technicians}" min="1">
                        </div>
                        <div class="stat-item" style="margin-left: 10px; margin-right: 10px;">Interruptions:&nbsp;<span class="interruptions-count">${timer.interruptions}</span></div>
                        <div class="stat-item">Defects: <span class="defects-count">${timer.defects}</span></div>
                    </div>
                </div>`;

            const timerContent = card.querySelector('.timer-content');
            timerContent.querySelector('.start-pause-btn').addEventListener('click', () => toggleTimer(timer.id));
            timerContent.querySelector('.reset-btn').addEventListener('click', () => resetTimer(timer.id));
            timerContent.querySelector('.delay-btn').addEventListener('click', () => toggleDelay(timer.id));
            timerContent.querySelector('.technician-input').addEventListener('change', (e) => updateTechnicians(timer.id, e.target.value));
            timerContent.querySelector('.task-title').addEventListener('click', makeTitleEditable);

            card.querySelector('.delete-btn').addEventListener('click', () => {
                if (confirm('Are you sure you want to delete this timer?')) {
                    deleteTimer(timer.id);
                }
            });

            let startX = 0, currentX = 0, diffX = 0, isDragging = false;
            
            const dragStart = (e) => {
                document.querySelectorAll('.timer-card.swiped').forEach(c => { if (c !== card) { c.classList.remove('swiped'); c.querySelector('.timer-content').style.transform = ''; }});
                startX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                isDragging = true;
                timerContent.style.transition = 'none';
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', dragEnd);
                document.addEventListener('touchmove', drag, { passive: true });
                document.addEventListener('touchend', dragEnd);
            };

            const drag = (e) => {
                if (!isDragging) return;
                currentX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                diffX = currentX - startX;
                if (diffX < 0 && diffX > -90) timerContent.style.transform = `translateX(${diffX}px)`;
            };

            const dragEnd = () => {
                if (!isDragging) return;
                isDragging = false;
                timerContent.style.transition = 'transform 0.3s ease';
                if (diffX < -50) {
                    card.classList.add('swiped');
                    timerContent.style.transform = 'translateX(-80px)';
                } else {
                    card.classList.remove('swiped');
                    timerContent.style.transform = 'translateX(0px)';
                }
                diffX = 0;
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('mouseup', dragEnd);
                document.removeEventListener('touchmove', drag);
                document.removeEventListener('touchend', dragEnd);
            };

            timerContent.addEventListener('mousedown', dragStart);
            timerContent.addEventListener('touchstart', dragStart, { passive: true });

            return card;
        }

        function deleteTimer(timerId) {
            if (!appState.currentJobId) return;
            const timers = appState.jobs[appState.currentJobId].timers;
            const timerIndex = timers.findIndex(t => t.id === timerId);
            if (timerIndex > -1) {
                timers.splice(timerIndex, 1);
                updateUI();
            }
        }

        function toggleTimer(timerId) {
            const timer = findTimer(timerId);
            if (!timer) return;
            timer.isRunning = !timer.isRunning;
            if (timer.isRunning) {
                timer.startTime = Date.now() - timer.elapsedTime;
                if (timer.isDelayLapActive) timer.delayLapStartTime = Date.now();
            } else {
                timer.elapsedTime = Date.now() - timer.startTime;
                if (timer.isDelayLapActive) timer.downtime += Date.now() - timer.delayLapStartTime;
            }
            updateUI();
        }

        function resetTimer(timerId) {
            if (!confirm('Are you sure you want to reset this timer?')) return;
            const timerIndex = appState.jobs[appState.currentJobId].timers.findIndex(t => t.id === timerId);
            if (timerIndex > -1) appState.jobs[appState.currentJobId].timers[timerIndex] = createTimerObject();
            updateUI();
        }

        function toggleDelay(timerId) {
            const timer = findTimer(timerId);
            if (!timer) return;
            timer.isDelayLapActive = !timer.isDelayLapActive;
            if (timer.isDelayLapActive) {
                timer.interruptions++;
                if (timer.isRunning) timer.delayLapStartTime = Date.now();
            } else {
                if (timer.isRunning) timer.downtime += Date.now() - timer.delayLapStartTime;
                delayReasonModal.style.display = 'flex';
                appState.modalCallback = (reason, isDefect) => {
                    timer.delayReasons.push(reason || 'No reason provided');
                    if (isDefect) timer.defects++;
                    delayReasonModal.style.display = 'none';
                    updateUI();
                };
            }
            updateUI();
        }

        function handleDelayReasonSubmit(e) {
            e.preventDefault();
            const reason = document.getElementById('delayReasonInput').value;
            const isDefect = document.getElementById('isDefectCheckbox').checked;
            if (appState.modalCallback) appState.modalCallback(reason, isDefect);
            delayReasonForm.reset();
            document.getElementById('isDefectCheckbox').checked = false;
        }
        
        function updateTechnicians(timerId, value) {
            const timer = findTimer(timerId);
            if(timer) timer.technicians = Math.max(1, parseInt(value));
        }

        function makeTitleEditable(e) {
            const titleDiv = e.target;
            const timerId = titleDiv.dataset.timerId;
            const timer = findTimer(timerId);
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'task-input';
            input.value = timer.taskDescription === 'Assign Task' ? '' : timer.taskDescription;
            const list = document.createElement('div');
            list.className = 'autocomplete-list';
            titleDiv.style.display = 'none';
            titleDiv.after(input);
            input.after(list);
            input.focus();
            input.addEventListener('keyup', () => filterTasks(input, list, timerId));
            input.addEventListener('blur', () => { setTimeout(() => { titleDiv.style.display = 'block'; input.remove(); list.remove(); }, 150); });
            filterTasks(input, list, timerId);
        }
        
        function filterTasks(input, list, timerId) {
            list.innerHTML = '';
            const query = input.value.toLowerCase();
            const filteredTasks = PREDEFINED_TASKS.filter(task => task.description.toLowerCase().includes(query) || task.id.toLowerCase().includes(query));
            filteredTasks.forEach(task => {
                const item = document.createElement('div');
                item.className = 'autocomplete-item';
                item.textContent = `${task.id} - ${task.description}`;
                item.addEventListener('mousedown', () => saveTask(timerId, task));
                list.appendChild(item);
            });
        }
        
        function saveTask(timerId, selectedTask) {
            const timer = findTimer(timerId);
            if (timer && selectedTask) {
                timer.taskID = selectedTask.id;
                timer.taskDescription = selectedTask.description;
            }
            updateUI();
        }

        function updateAllDisplays() {
            if (!appState.currentJobId) return;
            appState.jobs[appState.currentJobId].timers.forEach(timer => {
                const display = document.querySelector(`#${timer.id} .timer-display`);
                if (display) {
                    let timeToShow = timer.isRunning ? (Date.now() - timer.startTime) : timer.elapsedTime;
                    display.textContent = formatTime(timeToShow);
                }
            });
        }

        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
            const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
            const seconds = String(totalSeconds % 60).padStart(2, '0');
            const tenths = String(Math.floor((ms % 1000) / 100));
            return `${hours}:${minutes}:${seconds}.${tenths}`;
        }

        function findTimer(timerId) {
            return appState.currentJobId ? appState.jobs[appState.currentJobId].timers.find(t => t.id === timerId) : null;
        }
        
        function toMinutes(ms) { return (ms / 1000 / 60).toFixed(3); }

        function generateCsvContent() {
            if (appState.jobOrder.length === 0) {
                alert('No jobs to export.');
                return null;
            }

            const headers = ['Date', 'JobNumber', 'FanNumber', 'StationNumber', 'RTUSize', 'LineNumber', 'TaskID', 'ObservedTime (min)', 'Technicians', 'Interruptions', 'DelayReason', 'Defects', 'Downtime (min)'];
            let allRows = [];

            appState.jobOrder.forEach(jobId => {
                const job = appState.jobs[jobId];
                if (job.timers.length > 0) {
                    const rows = job.timers.map(timer => {
                        let finalElapsedTime = timer.isRunning ? (Date.now() - timer.startTime) : timer.elapsedTime;
                        const dateStr = job.details.Date;
                        let formattedDate = dateStr;
                        if (dateStr && dateStr.includes('-')) {
                            const [year, month, day] = dateStr.split('-');
                            formattedDate = `${month}/${day}/${year}`;
                        }
                        return [formattedDate, job.details.JobNumber, job.details.FanNumber, job.details.StationNumber, job.details.RTUSize, job.details.LineNumber, timer.taskID, toMinutes(finalElapsedTime), timer.technicians, timer.interruptions, `"${timer.delayReasons.join('; ')}"`, timer.defects, toMinutes(timer.downtime)].join(',');
                    });
                    allRows = allRows.concat(rows);
                }
            });

            if (allRows.length === 0) {
                alert('No timers recorded across all jobs.');
                return null;
            }

            return headers.join(',') + '\n' + allRows.join('\n');
        }
        
        function downloadCsv() {
            const csvContent = generateCsvContent();
            if (!csvContent) return;
            const encodedUri = encodeURI("data:text/csv;charset=utf-8," + csvContent);
            const link = document.createElement("a");
            
            const fileIdentifier = appState.jobOrder.map(jobId => {
                const details = appState.jobs[jobId].details;
                return [details.JobNumber, details.FanNumber, details.RTUSize].filter(Boolean).join('-');
            }).join('_');

            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `TimeStudy_${fileIdentifier}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        async function shareCsv() {
            const csvContent = generateCsvContent();
            if (!csvContent) return;

            const fileIdentifier = appState.jobOrder.map(jobId => {
                const details = appState.jobs[jobId].details;
                return [details.JobNumber, details.FanNumber, details.RTUSize].filter(Boolean).join('-');
            }).join('_');
            
            const fileName = `TimeStudy_${fileIdentifier}.csv`;
            const file = new File([csvContent], fileName, { type: 'text/csv' });

            if (navigator.share && navigator.canShare({ files: [file] })) {
                try {
                    await navigator.share({
                        files: [file],
                        title: 'Time Study Data',
                        text: `Here is the time study data for job(s): ${fileIdentifier}.`
                    });
                } catch (error) {
                    console.error('Error sharing:', error);
                }
            } else {
                alert('Sharing is not supported on this browser, or there is nothing to share.');
            }
        }

        init();
    });
    </script>

</body>
</html>
<!-- partial -->
  
</body>
</html>
